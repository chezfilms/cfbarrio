{# node--article.html.twig #}
{{ attach_library('bootstrap_barrio/node') }}

{%
  set classes = [
    'node',
    'node--type-' ~ node.bundle|clean_class,
    node.isPromoted() ? 'node--promoted',
    node.isSticky() ? 'node--sticky',
    not node.isPublished() ? 'node--unpublished',
    view_mode ? 'node--view-mode-' ~ view_mode|clean_class,
    'clearfix',
  ]
%}
<article{{ attributes.addClass(classes) }}>
  <header>
    {{ title_prefix }}
    {% if not page %}
      <h2{{ title_attributes.addClass('node__title') }}>
        <a href="{{ url }}" rel="bookmark">{{ label }}</a>
      </h2>
    {% endif %}
    {{ title_suffix }}

    {% if display_submitted %}
      <div class="node-metadata-inline">
          {# 1. Date Formatée #}
          <span class="metadata-date">{{ node.getCreatedTime|format_date('custom', 'd M y') }}</span>

          {# 2. Séparateur et Catégorie (une seule valeur autorisée) #}
          {# Assurez-vous que 'field_categorie' est le bon nom machine #}
          {% if node.field_categorie is not empty %}
          <span class="metadata-separator">·</span>
          {# On accède directement à l'entité du premier (et seul) item du champ #}
          {% set category_term = node.field_categorie.entity %}
          {# Une vérification supplémentaire pour s'assurer que le terme existe #}
          {% if category_term %}
          <span class="metadata-category">
              {{ category_term.label }}
          </span>
          {% endif %}
          {% endif %}


          {# 3. Séparateur et Tags (si le champ existe et n'est pas vide) #}
          {# Adaptez 'field_tags' si le nom machine est différent #}
          {% if node.field_tags is not empty %}
            {# --- CORRECTION ICI : Utiliser une boucle --- #}
            <span class="metadata-separator">·</span>
            <span class="metadata-tags">
              {% for item in node.field_tags %} {# Itérer sur les items du champ #}
                {% set term = item.entity %} {# Accéder à l'entité référencée via .entity #}
                {% if term %} {# Vérifier que l'entité terme existe bien #}
                  <a href="{{ url('entity.taxonomy_term.canonical', {'taxonomy_term': term.id}) }}" class="metadata-tag">{{- term.label -}}</a>
                {% endif %}
              {% endfor %}
            </span>
            {# --- FIN CORRECTION --- #}
          {% endif %}
      </div>
    {% endif %}

  </header>
  <div{{ content_attributes.addClass('node__content', 'clearfix') }}>
    {# Exclure les champs déjà affichés #}
    {# Adaptez 'field_tags' si le nom machine de votre champ est différent #}
    {{ content|without('field_tags', 'links') }}
  </div>
</article>
